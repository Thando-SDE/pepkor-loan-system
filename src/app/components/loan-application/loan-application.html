<!-- LOAN APPLICATION FORM - THE USER INTERFACE -->
<!-- This is what people see and interact with when applying for loans -->

<div class="loan-application">
  <!-- Form Title -->
  <h2>Loan Application Form</h2>
  
  <!-- Main Application Form -->
  <form (ngSubmit)="onSubmit()" #applicationForm="ngForm" class="application-form">
    
    <!-- Full Name Field -->
    <div class="form-group">
      <label for="fullName">Full Name *</label>
      <input type="text" id="fullName" name="fullName" 
             [(ngModel)]="application.fullName" required
             [class.error]="submitted && !application.fullName">
      <!-- Error message if name is missing -->
      <div *ngIf="submitted && !application.fullName" class="error-message">
        Full name is required
      </div>
    </div>

    <!-- Email Field -->
    <div class="form-group">
      <label for="email">Email Address *</label>
      <input type="email" id="email" name="email" 
             [(ngModel)]="application.email" required
             [class.error]="submitted && !application.email.includes('@')">
      <!-- Error message if email is invalid -->
      <div *ngIf="submitted && !application.email.includes('@')" class="error-message">
        Valid email address is required
      </div>
    </div>

    <!-- Income and Loan Amount (side by side) -->
    <div class="form-row">
      <!-- Monthly Income -->
      <div class="form-group">
        <label for="monthlyIncome">Monthly Income (R) *</label>
        <input type="number" id="monthlyIncome" name="monthlyIncome" 
               [(ngModel)]="application.monthlyIncome" min="0" step="100" required
               [class.error]="submitted && application.monthlyIncome <= 0">
        <div *ngIf="submitted && application.monthlyIncome <= 0" class="error-message">
          Monthly income must be greater than 0
        </div>
      </div>

      <!-- Requested Loan Amount -->
      <div class="form-group">
        <label for="requestedAmount">Requested Amount (R) *</label>
        <input type="number" id="requestedAmount" name="requestedAmount" 
               [(ngModel)]="application.requestedAmount" min="0" step="100" required
               [class.error]="submitted && application.requestedAmount <= 0">
        <div *ngIf="submitted && application.requestedAmount <= 0" class="error-message">
          Requested amount must be greater than 0
        </div>
      </div>
    </div>

    <!-- Existing Debts and Loan Term (side by side) -->
    <div class="form-row">
      <!-- Existing Debts -->
      <div class="form-group">
        <label for="existingDebts">Existing Debts (R)</label>
        <input type="number" id="existingDebts" name="existingDebts" 
               [(ngModel)]="application.existingDebts" min="0" step="100">
      </div>

      <!-- Loan Term Dropdown -->
      <div class="form-group">
        <label for="loanTerm">Loan Term *</label>
        <select id="loanTerm" name="loanTerm" [(ngModel)]="application.loanTerm" required class="form-select">
          <option value="" disabled selected>Select loan term</option>
          <option value="12">12 Months</option>
          <option value="24">24 Months</option>
          <option value="36">36 Months</option>
          <option value="48">48 Months</option>
          <option value="60">60 Months</option>
        </select>
        <!-- Error message if no term selected -->
        <div *ngIf="submitted && !application.loanTerm" class="error-message">
          Please select a loan term
        </div>
      </div>
    </div>

    <!-- Form Action Buttons -->
    <div class="form-actions">
      <!-- Submit Button -->
      <button type="submit" class="btn-primary" [disabled]="isLoading">
        {{ isLoading ? 'Processing...' : 'Submit Application' }}
      </button>
      
      <!-- Reset Button (only shows after decision) -->
      <button type="button" class="btn-secondary" (click)="resetForm()" *ngIf="decision">
        Apply Again
      </button>
    </div>
  </form>

  <!-- Loan Decision Display -->
  <div *ngIf="decision" class="decision-result" 
       [class.approved]="decision.isApproved" 
       [class.denied]="!decision.isApproved">
    
    <!-- Decision Header -->
    <div class="decision-header">
      <h3>Application Decision: {{ decision.isApproved ? '✅ Approved' : '❌ Denied' }}</h3>
    </div>
    
    <!-- Decision Details -->
    <div class="decision-body">
      <!-- Approved Loan Details -->
      <div *ngIf="decision.isApproved" class="approved-details">
        <p><strong>Approved Amount:</strong> R{{ decision.approvedAmount | number }}</p>
        <p><strong>Interest Rate:</strong> {{ decision.interestRate }}%</p>
        <p><strong>Monthly Payment:</strong> R{{ decision.monthlyPayment | number }}</p>
      </div>
      
      <!-- Denied Loan Reason -->
      <div *ngIf="!decision.isApproved" class="denied-details">
        <p><strong>Reason:</strong> {{ decision.decisionReason }}</p>
      </div>
    </div>
  </div>
</div>